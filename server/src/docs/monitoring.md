# Monitoring

Monitoring is like a car's dashboard for your software. Metrics show how fast your software is running, like a speedometer. Logs record your software's history, like a trip meter. Traces show your software's path, like a GPS.

## Metrics

- Metrics are numerical values that represent the state of a system at a point in time.
- They are typically used to monitor the health and performance of a system.
- Metrics can be collected at regular intervals to track changes over time.
- Examples of metrics include:
  - CPU usage
  - Memory usage
  - Disk I/O
  - Network traffic
  - Request latency
  - Error rates
- Metrics are often visualized in dashboards, allowing developers to quickly check the status of a system.
- They can also be used to trigger alerts when certain conditions are met.

## Logs

- Logs are records of events that happen in a system.
- They are typically used for debugging and troubleshooting, but can also provide valuable information for business and security analysis.
- Examples of logs include:
  - Application logs (e.g., log messages generated by your application)
  - Server logs (e.g., Apache or Nginx access logs, system logs)
  - Database logs (e.g., query logs, transaction logs)
  - Audit logs (e.g., records of user activity for security analysis)
- Logs can be searched and analyzed to find specific events, identify patterns, and diagnose problems.

## Traces

- Traces provide a detailed view of a single operation in a system.
- They are typically used in distributed systems to track a request as it travels through multiple services.
- A trace consists of multiple spans, where each span represents a single operation (e.g., a database query, a remote procedure call).
- Spans can be nested and form a tree structure.
- Traces can help identify performance bottlenecks, latency issues, and other problems that are difficult to diagnose with metrics and logs alone.

## Middleware Setup

This file, [performanceMiddlewares.ts](../middleware/performanceMiddlewares.ts), sets up middleware for an Express application. Middleware are functions that process incoming requests.

### Middleware Functions

Three middleware functions are defined:

1. **latencyMiddleware**: Measures and logs the latency of each request, and creates a tracing span.
2. **requestCountMiddleware**: Increments a counter for each request.
3. **errorCountMiddleware**: Increments a counter for each request that results in an error.

These middleware functions are added to the Express application using the `app.use()` function.

### Tools Used

1. **Prometheus (Metrics)**: Prometheus is a monitoring tool. Here, it's used to collect metrics about HTTP requests, such as latency (how long requests take), the total number of requests, and the number of requests that result in an error.

2. **OpenTelemetry (Metrics, Logs, Traces)**: Added the OpenTelemetry SDK to the application and used it to create a tracing span for each request. A tracing span represents a single operation, like sending a request.

3. **Winston (Logs)**: Added Winston to the application and used it to capture logs. Configured Winston to write logs to a file and to the console.

4. **Zipkin (Traces)**: Installed Zipkin on the server and configured OpenTelemetry to export traces to Zipkin.

5. **Grafana (Metrics, Logs, Traces - Visualization)**: Installed Grafana on the server and added Prometheus and Zipkin as data sources. Created dashboards to visualize the metrics and traces.
